<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Valentine</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500;600&display=swap" rel="stylesheet">

<style>
  /* ‚úÖ FIX: prevent white flash by giving HTML the same background (PAGE 1 default) */
  html {
    height: 100%;
    background: linear-gradient(to bottom, #FFE0EC 0%, #FFD0E2 100%);
  }

  body {
    margin: 0;
    height: 100%;
    font-family: 'Dancing Script', cursive;

    /* ‚úÖ PAGE 1 default gradient */
    background: linear-gradient(to bottom, #FFE0EC 0%, #FFD0E2 100%);

    /* ‚úÖ IMPORTANT TIP */
    background-blend-mode: soft-light;

    overflow: hidden;
    text-align: center;
    color: #E86A8D; /* ‚úÖ PAGE 1 text */
  }

  /* HEARTS LAYER (behind content, above background) */
  #heartsLayer {
    position: fixed;
    inset: 0;
    z-index: 1;
    pointer-events: none;
  }

  /* HEARTS */
  .heart {
    position: fixed;
    bottom: -40px;
    animation: floatFade linear infinite;
    opacity: 0;
    z-index: 1;
    pointer-events: none;
  }

  @keyframes floatFade {
    0% { transform: translateY(0); opacity: 0; }
    15% { opacity: 0.8; }
    80% { opacity: 0.6; }
    100% { transform: translateY(-120vh); opacity: 0; }
  }

  /* FADE-UP (existing) */
  .fade-up {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeUp 1.2s ease forwards;
  }
  .delay-1 { animation-delay: 0.3s; }
  .delay-2 { animation-delay: 0.6s; }
  .delay-3 { animation-delay: 0.9s; }

  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }

  /* PAGE BASE */
  .page {
    height: 100vh;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 2; /* ‚úÖ above hearts */
    background: transparent; /* ‚úÖ keep transparent so hearts show on all pages */
  }

  #page1 { display: flex; }

  /* TITLE */
  h1 {
    font-size: 76px;
    margin-bottom: 28px;
    margin-top: -30px;
  }

  /* BUTTON AREA */
  .buttons {
    display: flex;
    gap: 40px;
    width: 420px;
    justify-content: center;
    position: relative;
    margin-top: 20px;
    margin-bottom: 55px;
  }

  /* BASE BUTTON */
  button {
    padding: 18px 42px;
    font-size: 28px;
    border-radius: 50px;
    border: 3px solid #ff6b9a;
    cursor: pointer;
    font-family: inherit;
    transition: transform 0.4s ease;
  }

  /* YES BUTTON */
  #yesBtn {
    background: #ff2f68;
    color: white;
    position: absolute;
    left: 0;
    top: 0;
    transform: none !important;
  }
  #yesBtn:active, #yesBtn:focus { outline: none; }

  /* NO BUTTON */
  #noBtn {
    background: white;
    margin-left: 180px;
  }

  /* LOVE LINE */
  .love-line {
    font-size: 34px;
    margin-top: 0;
    opacity: 0.85;
  }

  /* PAGE 2 */
  #page2 h2 {
    font-size: 64px;
    margin-bottom: 20px;
  }

  .photos {
    display: flex;
    gap: 30px;
    margin: 25px 0;
  }
  .photos img {
    width: 240px;
    height: 320px;
    object-fit: cover;
    border-radius: 28px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.2);
  }

  .big-text {
    font-size: 42px;
    margin-top: 20px;
  }
  .small-text {
    font-size: 32px;
    margin-top: 10px;
  }

  /* ‚úÖ IMPORTANT TIP for text (applies everywhere) */
  h1, h2, .love-line, .big-text, .small-text, .p3-title, .p3-subtitle {
    text-shadow: 0 1px 2px rgba(0,0,0,0.08);
  }

  /* ‚úÖ TRANSITION UTILS */
  .transitioning {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
  }

  /* ‚úÖ Page 1 ‚Üí Page 2: Soft Zoom + Fade */
  .zoomFade-out {
    animation: zoomFadeOut 1.3s ease forwards;
  }
  .zoomFade-in {
    animation: zoomFadeIn 1.3s ease forwards;
  }

  @keyframes zoomFadeOut {
    0%   { transform: scale(1);    opacity: 1; filter: brightness(1); }
    100% { transform: scale(1.05); opacity: 0; filter: brightness(1); }
  }
  @keyframes zoomFadeIn {
    0%   { transform: scale(0.98); opacity: 0; filter: brightness(1); }
    100% { transform: scale(1);    opacity: 1; filter: brightness(1); }
  }

  /* ‚úÖ Page 2 ‚Üí Page 3: Curtain (single panel slide LEFT) + slightly darker while sliding */
  .curtain-left-out {
    animation: curtainLeftOut 3s cubic-bezier(0.25, 1, 0.35, 1) forwards;
  }
  .curtain-reveal-in {
    animation: curtainRevealIn 3s cubic-bezier(0.25, 1, 0.35, 1) forwards;
  }

  @keyframes curtainLeftOut {
    0%   { transform: translateX(0);     opacity: 1; filter: brightness(1); }
    100% { transform: translateX(-110%); opacity: 1; filter: brightness(0.85); }
  }
  @keyframes curtainRevealIn {
    0%   { opacity: 0; transform: scale(0.995); }
    100% { opacity: 1; transform: scale(1); }
  }

  /* ‚úÖ Page 2 ‚Üí Page 3 button */
  #moreBtn {
    position: fixed;
    right: 26px;
    bottom: 26px;
    background: rgba(255,255,255,0.9);
    color: #ff2f68;
    border: 3px solid #ff6b9a;
    border-radius: 50px;
    padding: 14px 26px;
    font-size: 26px;
    font-family: inherit;
    cursor: pointer;
    z-index: 5;

    display: none;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.8s ease;
  }
  #moreBtn.show {
    display: block;
    opacity: 1;
    pointer-events: auto;
  }

  /* ‚úÖ PAGE 3 title */
  #page3 { }

  .p3-title {
    font-size: 72px;
    margin: 0 0 28px 0;
    opacity: 0.95;
    font-weight: 700;
    color: #91507F; /* ‚úÖ PAGE 3 text */
  }
  .p3-subtitle {
    font-size: 34px;
    margin: 0 0 38px 0;
    opacity: 0.85;
  }

  .gift-row {
    display: flex;
    gap: 56px;
    justify-content: center;
    align-items: center;
    margin-top: 10px;
  }

  .gift-box {
    background: transparent;
    border: 0;
    box-shadow: none;
    width: auto;
    height: auto;
    border-radius: 0;
    cursor: pointer;
    user-select: none;
    position: relative;
    overflow: visible;
    transform: translateZ(0);
    animation: giftIdle 2.6s ease-in-out infinite;
  }

  @keyframes giftIdle {
    0%,100% { transform: translateY(0); }
    50%     { transform: translateY(-8px); }
  }

  .gift-img {
    width: 168px;
    height: auto;
    display: block;
    filter: drop-shadow(0 16px 26px rgba(0,0,0,0.14));
    pointer-events: none;
  }

  @keyframes giftOpenBounce {
    0%   { transform: scale(1); }
    35%  { transform: scale(1.13); }
    60%  { transform: scale(0.96); }
    80%  { transform: scale(1.06); }
    100% { transform: scale(1); }
  }

  .open-bounce {
    animation: giftOpenBounce 0.55s ease forwards;
  }

  /* Gift pages */
  .gift-page {
    display: none;
    position: fixed;
    inset: 0;
    z-index: 6;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(to bottom, #F6DCF7 0%, #FFE0EA 100%); /* ‚úÖ PAGE 3 gradient */
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    color: #91507F; /* ‚úÖ PAGE 3 text */
  }

  .backBtn {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 22px;
    background: rgba(255,255,255,0.9);
    color: #ff2f68;
    border: 3px solid #ff6b9a;
    border-radius: 50px;
    padding: 12px 26px;
    font-size: 26px;
    cursor: pointer;
    z-index: 7;
  }

  /* ‚úÖ ‚úÖ ‚úÖ GIFT 1 CARD ‚Äî FIXED to match your screenshot requests */
  .spotify-card {
    width: 320px;              /* ‚úÖ your "2" = 320px */
    border-radius: 22px;
    background: #EEE7EB;       /* ‚úÖ requested card color */
    box-shadow: 0 22px 50px rgba(0,0,0,0.18);
    padding: 16px;
    position: relative;
    overflow: hidden;
  }

  /* subtle paper texture + tiny bows/hearts */
  .spotify-card::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at 20% 25%, rgba(0,0,0,0.03), transparent 58%),
      radial-gradient(circle at 80% 80%, rgba(0,0,0,0.025), transparent 60%),
      url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140' viewBox='0 0 140 140'%3E%3Cg fill='none' stroke='%2391507F' stroke-opacity='0.14' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M26 36c0-5 6-8 10-3 4-5 10-2 10 3 0 8-10 13-10 13S26 44 26 36Z'/%3E%3Cpath d='M98 26c3-3 7-3 10 0 3 3 3 7 0 10'/%3E%3Cpath d='M98 36c3-3 7-3 10 0 3 3 3 7 0 10'/%3E%3Cpath d='M94 31c8 0 16 0 24 0'/%3E%3Cpath d='M46 96c3-3 7-3 10 0 3 3 3 7 0 10'/%3E%3Cpath d='M46 106c3-3 7-3 10 0 3 3 3 7 0 10'/%3E%3Cpath d='M42 101c8 0 16 0 24 0'/%3E%3C/g%3E%3C/svg%3E");
    background-size: auto, auto, 140px 140px;
    background-repeat: no-repeat, no-repeat, repeat;
    opacity: 0.55;
    pointer-events: none;
  }

  .spotify-top {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  /* ‚úÖ Image should show full (no crop) */
  .cover {
    width: 100%;
    height: 170px;
    border-radius: 16px;
    object-fit: contain;                 /* ‚úÖ FULL image visible */
    background: rgba(0,0,0,0.10);        /* ‚úÖ soft backing like screenshot */
    box-shadow: 0 14px 30px rgba(0,0,0,0.14);
  }

  /* track name like screenshot */
  .track-name {
    width: 100%;
    text-align: center;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
    font-size: 26px;
    letter-spacing: 1px;
    color: rgba(25,18,22,0.75);
    margin: 2px 0 0 0;
  }

  /* ‚úÖ progress bar with dot + fill behind dot */
  .mini-progress {
    position: relative;
    z-index: 1;
    width: 100%;
    margin-top: 10px;
  }

  .mini-progress .bar {
    position: relative;
    width: 100%;
    height: 7px;
    background: rgba(25,18,22,0.18);
    border-radius: 999px;
    overflow: visible;
  }

  /* filled line */
  #progressFill {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0%;
    background: rgba(25,18,22,0.35);
    border-radius: 999px;
  }

  /* dot that moves */
  #progressDot {
    position: absolute;
    top: 50%;
    left: 0%;
    width: 18px;
    height: 18px;
    transform: translate(-50%, -50%);
    background: rgba(25,18,22,0.75);
    border-radius: 50%;
    box-shadow: 0 10px 18px rgba(0,0,0,0.12);
  }

  /* controls: prev / big play circle / next */
  .controls {
    position: relative;
    z-index: 1;
    margin-top: 14px;
    display: flex;
    gap: 22px;
    align-items: center;
    justify-content: center;
  }

  .sideBtn {
    width: 48px;
    height: 48px;
    border-radius: 999px;
    border: 0;
    background: transparent;
    color: rgba(25,18,22,0.78);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    padding: 0;
    cursor: pointer;
  }
  .sideBtn:active { transform: scale(0.97); }

  .iconBtn {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    border: 2px solid rgba(25,18,22,0.65);
    background: #ffffff;               /* ‚úÖ white circle */
    color: rgba(25,18,22,0.82);        /* ‚úÖ dark icon */
    font-size: 22px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    box-shadow: 0 16px 30px rgba(0,0,0,0.10);
    transition: transform 0.15s ease;
  }
  .iconBtn:active { transform: scale(0.96); }

  /* ‚úÖ remove timing numbers completely */
  .timeRow { display: none !important; }

  /* Gift 2 stickers */
  .sticker-wrap {
    display: flex;
    gap: 26px;
    align-items: center;
    justify-content: center;
    margin-top: 10px;
  }

  .sticker {
    width: 260px;
    height: auto;
    filter: drop-shadow(0 14px 24px rgba(0,0,0,0.18));
    animation: popIn 0.55s ease forwards;
    transform: scale(0.92);
    opacity: 0;
    outline: 10px solid rgba(255,255,255,0.92);
    outline-offset: -6px;
    border-radius: 22px;
  }

  @keyframes popIn {
    to { transform: scale(1); opacity: 1; }
  }

  /* Gift 3 letter */
  .letter {
    width: min(760px, 90vw);
    border-radius: 28px;
    background: rgba(255,255,255,0.72);
    border: 3px solid rgba(255,107,154,0.55);
    box-shadow: 0 18px 46px rgba(0,0,0,0.18);
    padding: 26px 26px;
    text-align: left;
  }

  .letter h3 {
    margin: 0 0 10px 0;
    font-size: 44px;
    text-align: center;
  }

  .letter p {
    font-size: 28px;
    line-height: 1.35;
    margin: 0;
    opacity: 0.92;
  }
</style>
</head>

<body>

<div id="heartsLayer"></div>

<!-- PAGE 1 -->
<div id="page1" class="page">
  <h1 class="fade-up">Fatima‚Ä¶ will you be my Valentine?</h1>

  <div class="buttons fade-up delay-1">
    <button id="yesBtn" type="button">Yes I will</button>
    <button id="noBtn" type="button">No</button>
  </div>

  <div class="love-line fade-up delay-2">
    Every moment with you feels like a dream come true‚Ä¶
  </div>
</div>

<!-- PAGE 2 -->
<div id="page2" class="page">
  <h2 class="fade-up">Yayyy! I knew you‚Äôd say yes ‚ù§Ô∏è</h2>

  <div class="photos fade-up delay-1">
    <img src="pic1.jpg" alt="">
    <img src="pic2.jpg" alt="">
    <img src="pic3.jpg" alt="">
    <img src="pic4.jpg" alt="">
  </div>

  <div class="big-text fade-up delay-2">
    Can‚Äôt wait to make more memories with you‚Ä¶
  </div>

  <div class="small-text fade-up delay-3">
    You made me the happiest
  </div>
</div>

<button id="moreBtn" type="button">One more thing‚Ä¶</button>

<!-- PAGE 3 -->
<div id="page3" class="page">
  <div class="fade-up">
    <div class="p3-title">I got you a little surprises‚Ä¶</div>
  </div>

  <div class="gift-row fade-up delay-1">
    <div class="gift-box" id="gift1">
      <img class="gift-img" src="gift.png" alt="">
    </div>
    <div class="gift-box" id="gift2">
      <img class="gift-img" src="gift.png" alt="">
    </div>
    <div class="gift-box" id="gift3">
      <img class="gift-img" src="gift.png" alt="">
    </div>
  </div>
</div>

<!-- GIFT 1 PAGE -->
<div id="gift1Page" class="gift-page">
  <div class="spotify-card">
    <div class="spotify-top">
      <img class="cover" src="cover.jpg" alt="">
      <div class="track-name">Arz Kiya Hai</div>
    </div>

    <div class="mini-progress">
      <div class="bar">
        <div id="progressFill"></div>
        <div id="progressDot" aria-hidden="true"></div>
      </div>
    </div>

    <div class="controls">
      <button class="sideBtn" type="button" aria-label="Previous">‚èÆ</button>
      <button class="iconBtn" id="playPauseBtn" type="button" aria-label="Play/Pause">‚ñ∂</button>
      <button class="sideBtn" type="button" aria-label="Next">‚è≠</button>
    </div>

    <!-- kept in HTML but hidden by CSS -->
    <div class="timeRow">
      <span id="curTime">0:00</span>
      <span id="endTime">2:26</span>
    </div>
  </div>

  <button class="backBtn" id="backFromGift1" type="button">Go back</button>
</div>

<!-- GIFT 2 PAGE -->
<div id="gift2Page" class="gift-page">
  <div class="p3-title">A little bouquet‚Ä¶ and a panda üêº</div>

  <div class="sticker-wrap">
    <img class="sticker" src="flowers.png" alt="">
    <img class="sticker" src="panda.png" alt="">
  </div>

  <button class="backBtn" id="backFromGift2" type="button">Go back</button>
</div>

<!-- GIFT 3 PAGE -->
<div id="gift3Page" class="gift-page">
  <div class="letter">
    <h3>For you ‚ù§Ô∏è</h3>
    <p>
      Loving you feels quiet and beautiful, like a soft moment the world pauses for. In your presence, my heart learns how to be gentle, how to feel safe, how to hope. I carry you in my thoughts, in my smiles, and in the calm that settles over me‚Äîand in that stillness, I understand that loving you is something my heart chooses, again and again.
    </p>
  </div>

  <button class="backBtn" id="backFromGift3" type="button">Go back</button>
</div>

<audio id="giftSong" src="song.mp3" preload="auto"></audio>

<script>
document.addEventListener("DOMContentLoaded", () => {

  /* ‚úÖ PAGE THEMES */
  const THEMES = {
    page1: {
      bg: "linear-gradient(to bottom, #FFE0EC 0%, #FFD0E2 100%)",
      text: "#E86A8D",
      hearts: ["#FFA3BE", "#FFD1DD"]
    },
    page2: {
      bg: "linear-gradient(to bottom, #FFE9C9 0%, #FFC7D6 100%)",
      text: "#D94A76",
      hearts: ["#FF5F7E", "#FF88A2"]
    },
    page3: {
      bg: "linear-gradient(to bottom, #F6DCF7 0%, #FFE0EA 100%)",
      text: "#91507F",
      hearts: ["#D8A3C8", "#F6B8CF"]
    }
  };

  /* HEARTS (palette changes per page) */
  let heartColors = THEMES.page1.hearts;

  let activeHearts = 0;
  const MIN_HEARTS = 35;
  const MAX_HEARTS = 55;
  const WARM_START_MS = 2000;
  let startTime = Date.now();
  const heartsLayer = document.getElementById("heartsLayer");

  function applyTheme(key) {
    const t = THEMES[key];
    if (!t) return;

    document.documentElement.style.background = t.bg;
    document.body.style.background = t.bg;
    document.body.style.color = t.text;

    const p3Title = document.querySelector(".p3-title");
    if (p3Title) p3Title.style.color = t.text;

    const giftPages = document.querySelectorAll(".gift-page");
    giftPages.forEach(gp => {
      gp.style.background = t.bg;
      gp.style.color = t.text;
    });

    /* ‚úÖ HARD RESET: remove all existing hearts + restart timing */
    heartsLayer.innerHTML = "";
    activeHearts = 0;
    startTime = Date.now();
    heartColors = t.hearts;
  }

  function createHeart() {
    if (activeHearts >= MAX_HEARTS) return;

    const h = document.createElement("div");
    h.className = "heart";
    h.innerHTML = "‚ù§";

    h.style.left = Math.random() * 100 + "vw";
    h.style.fontSize = (14 + Math.random() * 20) + "px";
    h.style.color = heartColors[Math.floor(Math.random() * heartColors.length)];
    h.style.animationDuration = (10 + Math.random() * 1.5) + "s";

    if (Date.now() - startTime < WARM_START_MS) {
      h.style.bottom = Math.random() * 100 + "vh";
    }

    activeHearts++;
    h.addEventListener("animationend", () => {
      h.remove();
      activeHearts--;
    });

    heartsLayer.appendChild(h);
  }

  (function spawnLoop() {
    if (activeHearts < MIN_HEARTS) {
      createHeart(); createHeart();
      setTimeout(spawnLoop, 120);
    } else if (activeHearts < MAX_HEARTS) {
      createHeart();
      setTimeout(spawnLoop, 220);
    } else {
      setTimeout(spawnLoop, 350);
    }
  })();

  function showHearts(show) {
    heartsLayer.style.display = show ? "block" : "none";
  }

  /* NO BUTTON */
  const noBtn = document.getElementById("noBtn");
  const texts = ["Are you sure?", "Try again", "Nice try", "No escape", "Nah bossss", "Wait really...?"];
  let t = 0;
  let p = 0;

  const moves = [
    { x: 300,  y: -200 },
    { x: -350, y: -180 },
    { x: 400,  y: 220 },
    { x: -420, y: 260 },
    { x: 0,    y: -300 },
    { x: 0,    y: 320 },
    { x: 450,  y: 0 },
    { x: -450, y: 0 }
  ];

  noBtn.onclick = () => {
    t = (t + 1) % texts.length;
    noBtn.textContent = texts[t];
    p = (p + 1) % moves.length;
    noBtn.style.transform = `translate(${moves[p].x}px, ${moves[p].y}px)`;
  };

  /* ‚úÖ Page 1 ‚Üí Page 2: Soft Zoom + Fade */
  function zoomFadeToPage(fromEl, toEl) {
    fromEl.classList.add("transitioning");
    toEl.classList.add("transitioning");

    toEl.style.display = "flex";
    toEl.classList.add("zoomFade-in");
    fromEl.classList.add("zoomFade-out");

    setTimeout(() => {
      fromEl.style.display = "none";

      fromEl.classList.remove("transitioning", "zoomFade-out");
      toEl.classList.remove("transitioning", "zoomFade-in");
    }, 1300);
  }

  /* ‚úÖ Page 2 ‚Üí Page 3: Curtain reveal (whole page slides LEFT, slightly darker only while sliding) */
  function curtainLeftToPage(fromEl, toEl) {
    toEl.style.display = "flex";

    toEl.style.zIndex = "1";
    fromEl.style.zIndex = "2";

    fromEl.classList.add("transitioning");
    toEl.classList.add("transitioning");

    toEl.classList.add("curtain-reveal-in");
    fromEl.classList.add("curtain-left-out");

    setTimeout(() => {
      fromEl.style.display = "none";

      fromEl.classList.remove("transitioning", "curtain-left-out");
      toEl.classList.remove("transitioning", "curtain-reveal-in");

      fromEl.style.zIndex = "";
      toEl.style.zIndex = "";
    }, 3000);
  }

  /* ‚úÖ Apply initial theme (page1) */
  applyTheme("page1");

  /* YES BUTTON (page1 -> page2) */
  document.getElementById("yesBtn").onclick = () => {
    const page1 = document.getElementById("page1");
    const page2 = document.getElementById("page2");
    const moreBtn = document.getElementById("moreBtn");

    applyTheme("page2");
    zoomFadeToPage(page1, page2);

    moreBtn.classList.remove("show");
    setTimeout(() => {
      if (page2.style.display === "flex") moreBtn.classList.add("show");
    }, 5000);
  };

  /* Page 2 -> Page 3 button */
  document.getElementById("moreBtn").onclick = () => {
    const page2 = document.getElementById("page2");
    const page3 = document.getElementById("page3");
    const moreBtn = document.getElementById("moreBtn");

    moreBtn.classList.remove("show");

    applyTheme("page3");
    curtainLeftToPage(page2, page3);
  };

  /* PAGE 3 gift pages */
  const gift1Page = document.getElementById("gift1Page");
  const gift2Page = document.getElementById("gift2Page");
  const gift3Page = document.getElementById("gift3Page");

  function openGift(giftPageEl) {
    giftPageEl.style.display = "flex";
  }

  function closeGift(giftPageEl) {
    if (giftPageEl === gift1Page) stopSong(true);
    giftPageEl.style.display = "none";
  }

  function bounceAndOpen(giftBoxEl, giftPageEl, alsoStartSong) {
    giftBoxEl.classList.remove("open-bounce");
    void giftBoxEl.offsetWidth;
    giftBoxEl.classList.add("open-bounce");

    setTimeout(() => {
      openGift(giftPageEl);
      if (alsoStartSong) startSong();
    }, 160);
  }

  const gift1El = document.getElementById("gift1");
  const gift2El = document.getElementById("gift2");
  const gift3El = document.getElementById("gift3");

  gift1El.addEventListener("animationend", (e) => {
    if (e.animationName === "giftOpenBounce") gift1El.classList.remove("open-bounce");
  });
  gift2El.addEventListener("animationend", (e) => {
    if (e.animationName === "giftOpenBounce") gift2El.classList.remove("open-bounce");
  });
  gift3El.addEventListener("animationend", (e) => {
    if (e.animationName === "giftOpenBounce") gift3El.classList.remove("open-bounce");
  });

  gift1El.onclick = () => bounceAndOpen(gift1El, gift1Page, true);
  gift2El.onclick = () => bounceAndOpen(gift2El, gift2Page, false);
  gift3El.onclick = () => bounceAndOpen(gift3El, gift3Page, false);

  document.getElementById("backFromGift1").onclick = () => closeGift(gift1Page);
  document.getElementById("backFromGift2").onclick = () => closeGift(gift2Page);
  document.getElementById("backFromGift3").onclick = () => closeGift(gift3Page);

  /* Gift 1 song controls (0:18 -> 2:26 + fade out) */
  const song = document.getElementById("giftSong");
  const playPauseBtn = document.getElementById("playPauseBtn");
  const progressFill = document.getElementById("progressFill");
  const progressDot = document.getElementById("progressDot");

  const START_AT = 18;
  const END_AT = 146;

  let progressTimer = null;
  let stopWatcher = null;
  let fading = false;

  function startSong() {
    try {
      fading = false;
      song.pause();
      song.currentTime = START_AT;
      song.volume = 1;

      const playPromise = song.play();
      if (playPromise && playPromise.catch) playPromise.catch(() => {});

      playPauseBtn.textContent = "‚è∏";
      beginProgress();
      beginStopWatcher();
    } catch (e) {}
  }

  function toggleSong() {
    if (song.paused) {
      const p = song.play();
      if (p && p.catch) p.catch(() => {});
      playPauseBtn.textContent = "‚è∏";
      beginProgress();
      beginStopWatcher();
    } else {
      song.pause();
      playPauseBtn.textContent = "‚ñ∂";
      clearInterval(progressTimer);
      clearInterval(stopWatcher);
    }
  }

  function beginProgress() {
    clearInterval(progressTimer);
    progressTimer = setInterval(() => {
      const cur = song.currentTime;
      const total = (END_AT - START_AT);
      const pct = Math.min(100, Math.max(0, ((cur - START_AT) / total) * 100));

      /* ‚úÖ fill line */
      progressFill.style.width = pct + "%";

      /* ‚úÖ dot moves + starts at far left */
      progressDot.style.left = pct + "%";
    }, 120);
  }

  function beginStopWatcher() {
    clearInterval(stopWatcher);
    stopWatcher = setInterval(() => {
      if (song.currentTime >= END_AT && !fading) fadeOutSong();
    }, 150);
  }

  function fadeOutSong() {
    fading = true;
    clearInterval(stopWatcher);

    const fade = setInterval(() => {
      if (song.volume > 0.06) {
        song.volume -= 0.06;
      } else {
        stopSong(false);
        clearInterval(fade);
      }
    }, 140);
  }

  function stopSong(resetToStart) {
    clearInterval(progressTimer);
    clearInterval(stopWatcher);
    song.pause();
    song.volume = 1;
    if (resetToStart) song.currentTime = START_AT;
    playPauseBtn.textContent = "‚ñ∂";
    progressFill.style.width = "0%";
    progressDot.style.left = "0%";
    fading = false;
  }

  playPauseBtn.onclick = toggleSong;

});
</script>

</body>
</html>
